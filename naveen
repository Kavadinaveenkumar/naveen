<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperHub Pro - Complete Social Productivity App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #6366f1; --secondary: #8b5cf6; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .app-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .navbar-brand { font-weight: bold; font-size: 1.5rem; }
        .tab-content { display: none; padding: 20px 0; }
        .tab-content.active { display: block; }
        .media-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
        .media-item { position: relative; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .media-item img, .media-item video { width: 100%; height: 200px; object-fit: cover; }
        .media-overlay { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.7); color: white; padding: 10px; }
        .like-btn { background: var(--primary); border: none; color: white; padding: 5px 10px; border-radius: 20px; cursor: pointer; }
        .chat-messages { max-height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 10px; background: #f8f9fa; }
        .todo-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .todo-checkbox { margin-right: 10px; transform: scale(1.2); }
        .profile-pic { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid white; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
        .friend-card { transition: transform 0.2s; }
        .friend-card:hover { transform: translateY(-5px); }
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px; border-radius: 10px; color: white; z-index: 1000; }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary rounded-3 mb-4 shadow-lg">
            <div class="container-fluid">
                <a class="navbar-brand" href="#"><i class="fas fa-rocket me-2"></i>SuperHub Pro</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('feed')"><i class="fas fa-home me-1"></i>Feed</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('gallery')"><i class="fas fa-images me-1"></i>Gallery</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('friends')"><i class="fas fa-users me-1"></i>Friends</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('todo')"><i class="fas fa-list me-1"></i>To-Do</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('study')"><i class="fas fa-book me-1"></i>Study</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('chat')"><i class="fas fa-comments me-1"></i>Chat</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('profile')"><i class="fas fa-user me-1"></i>Profile</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('activity')"><i class="fas fa-history me-1"></i>Activity</a></li>
                    </ul>
                    <div id="userInfo" class="d-none">
                        <span id="userDisplayName" class="me-3 text-white"></span>
                        <button class="btn btn-outline-light btn-sm" onclick="signOut()"><i class="fas fa-sign-out-alt me-1"></i>Logout</button>
                    </div>
                    <button id="loginBtn" class="btn btn-outline-light" onclick="signInWithGoogle()"><i class="fab fa-google me-1"></i>Login</button>
                </div>
            </div>
        </nav>

        <!-- Tabs Content -->
        <div id="tabContent">
            <!-- Feed Tab -->
            <div id="feed" class="tab-content active">
                <h3><i class="fas fa-rss me-2"></i>Social Feed</h3>
                <div class="input-group mb-3">
                    <input type="text" id="postInput" class="form-control" placeholder="What's happening? Share text, photo, or video...">
                    <input type="file" id="postMedia" class="form-control" accept="image/*,video/*">
                    <button class="btn btn-primary" onclick="createPost()"><i class="fas fa-paper-plane"></i> Post</button>
                </div>
                <div id="feedPosts" class="media-grid"></div>
            </div>

            <!-- Gallery Tab -->
            <div id="gallery" class="tab-content">
                <h3><i class="fas fa-images me-2"></i>My Gallery</h3>
                <div class="input-group mb-3">
                    <input type="file" id="galleryMedia" class="form-control" accept="image/*,video/*" multiple>
                    <button class="btn btn-success" onclick="uploadToGallery()"><i class="fas fa-upload"></i> Upload</button>
                </div>
                <div id="userGallery" class="media-grid"></div>
            </div>

            <!-- Friends Tab -->
            <div id="friends" class="tab-content">
                <h3><i class="fas fa-users me-2"></i>Friends</h3>
                <div class="input-group mb-3">
                    <input type="text" id="searchFriends" class="form-control" placeholder="Search friends by name..." oninput="searchFriends()">
                    <button class="btn btn-info"><i class="fas fa-search"></i></button>
                </div>
                <div id="friendsList" class="row"></div>
                <div id="friendRequests" class="mt-3"></div>
            </div>

            <!-- To-Do Tab -->
            <div id="todo" class="tab-content">
                <h3><i class="fas fa-list-check me-2"></i>To-Do List</h3>
                <div class="input-group mb-3">
                    <input type="text" id="newTodo" class="form-control" placeholder="Add new task...">
                    <button class="btn btn-primary" onclick="addTodo()"><i class="fas fa-plus"></i></button>
                </div>
                <div id="todoList"></div>
            </div>

            <!-- Study Tab -->
            <div id="study" class="tab-content">
                <h3><i class="fas fa-book me-2"></i>Study Plans</h3>
                <div class="row g-3 mb-3">
                    <div class="col-md-4"><input type="text" id="studySubject" class="form-control" placeholder="Subject"></div>
                    <div class="col-md-4"><input type="number" id="studyDuration" class="form-control" placeholder="Duration (min)"></div>
                    <div class="col-md-4"><input type="text" id="studyNotes" class="form-control" placeholder="Notes"></div>
                </div>
                <button class="btn btn-success mb-3" onclick="addStudySession()"><i class="fas fa-bookmark"></i> Add Session</button>
                <div id="studyList"></div>
            </div>

            <!-- Chat Tab -->
            <div id="chat" class="tab-content">
                <h3><i class="fas fa-comments me-2"></i>Chat</h3>
                <select id="chatFriend" class="form-select mb-2" onchange="loadChat()">
                    <option>Select friend</option>
                </select>
                <div id="chatMessages" class="chat-messages"></div>
                <div class="input-group">
                    <input type="text" id="chatInput" class="form-control" placeholder="Type message..." onkeypress="if(event.key==='Enter') sendMessage()">
                    <button class="btn btn-primary" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profile" class="tab-content">
                <h3><i class="fas fa-user me-2"></i>Profile</h3>
                <div class="text-center mb-4">
                    <img id="profilePic" class="profile-pic mb-3" src="https://via.placeholder.com/120?text=You" alt="Profile">
                    <input type="file" id="profilePhoto" class="form-control mb-2" accept="image/*" onchange="updateProfilePic()">
                    <h4 id="profileName">Your Name</h4>
                    <input type="text" id="profileBio" class="form-control" placeholder="Update bio...">
                    <button class="btn btn-primary mt-2" onclick="updateProfile()">Update Profile</button>
                </div>
            </div>

            <!-- Activity Tab -->
            <div id="activity" class="tab-content">
                <h3><i class="fas fa-history me-2"></i>Activity Log</h3>
                <div id="activityLog" class="list-group"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, onSnapshot, updateDoc, doc, arrayUnion, arrayRemove, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js';

        // REPLACE WITH YOUR FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "123456789",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        let currentUser = null;
        let friends = [];

        // Auth listener
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                document.getElementById('loginBtn').classList.add('d-none');
                document.getElementById('userInfo').classList.remove('d-none');
                loadUserData();
                loadFriends();
                showNotification('Welcome back!', 'success');
                logActivity('Logged in');
            } else {
                document.getElementById('loginBtn').classList.remove('d-none');
                document.getElementById('userInfo').classList.add('d-none');
            }
        });

        // Quick anonymous login for demo (replace with real auth)
        window.signInWithGoogle = async () => {
            try {
                const provider = new GoogleAuthProvider();
                await signInWithPopup(auth, provider);
            } catch (e) {
                signInAnonymously(auth);
            }
        };

        window.signOut = () => signOut(auth);

        // Load user profile
        async function loadUserData() {
            const userDoc = await getDocs(query(collection(db, 'users'), where('uid', '==', currentUser.uid)));
            if (userDoc.empty) {
                await addDoc(collection(db, 'users'), {
                    uid: currentUser.uid,
                    name: currentUser.displayName || 'User',
                    email: currentUser.email,
                    bio: '',
                    photoUrl: '',
                    createdAt: serverTimestamp()
                });
            } else {
                const data = userDoc.docs[0].data();
                document.getElementById('profileName').textContent = data.name;
                document.getElementById('profileBio').value = data.bio || '';
                if (data.photoUrl) document.getElementById('profilePic').src = data.photoUrl;
                document.getElementById('userDisplayName').textContent = data.name;
            }
        }

        // Posts/Feed
        window.createPost = async () => {
            const text = document.getElementById('postInput').value;
            const fileInput = document.getElementById('postMedia');
            let mediaUrl = '';
            
            if (fileInput.files[0]) {
                const file = fileInput.files[0];
                const storageRef = ref(storage, `posts/${Date.now()}_${file.name}`);
                await uploadBytes(storageRef, file);
                mediaUrl = await getDownloadURL(storageRef);
            }
            
            await addDoc(collection(db, 'posts'), {
                userId: currentUser.uid,
                text: text,
                mediaUrl: mediaUrl,
                likes: [],
                comments: [],
                createdAt: serverTimestamp()
            });
            
            document.getElementById('postInput').value = '';
            fileInput.value = '';
            logActivity('Created post');
            loadFeed();
        };

        function loadFeed() {
            const q = query(collection(db, 'posts'), orderBy('createdAt', 'desc'));
            onSnapshot(q, (snap) => {
                const postsDiv = document.getElementById('feedPosts');
                postsDiv.innerHTML = '';
                snap.docs.forEach(doc => {
                    const post = doc.data();
                    const div = createMediaItem(post, doc.id);
                    postsDiv.appendChild(div);
                });
            });
        }

        function createMediaItem(post, id) {
            const div = document.createElement('div');
            div.className = 'media-item card';
            div.innerHTML = `
                <div style="background-image: url('${post.mediaUrl || 'https://via.placeholder.com/250x200?text=Post'}'); background-size: cover; height: 200px;"></div>
                <div class="card-body p-3">
                    <p class="mb-2">${post.text || ''}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <button class="like-btn" onclick="toggleLike('${id}', '${currentUser.uid}')">
                            <i class="fas fa-heart ${post.likes?.includes(currentUser.uid) ? 'text-danger' : ''}"></i> ${post.likes?.length || 0}
                        </button>
                        <small>${post.createdAt?.toDate ? post.createdAt.toDate().toLocaleString() : ''}</small>
                    </div>
                </div>
            `;
            return div;
        }

        window.toggleLike = async (postId, userId) => {
            const postRef = doc(db, 'posts', postId);
            const postSnap = await getDoc(postRef);
            const post = postSnap.data();
            if (post.likes.includes(userId)) {
                await updateDoc(postRef, { likes: arrayRemove(userId) });
            } else {
                await updateDoc(postRef, { likes: arrayUnion(userId) });
            }
        };

        // Gallery
        window.uploadToGallery = async () => {
            const files = document.getElementById('galleryMedia').files;
            for (let file of Array.from(files)) {
                const storageRef = ref(storage, `gallery/${currentUser.uid}/${Date.now()}_${file.name}`);
                await uploadBytes(storageRef, file);
                const url = await getDownloadURL(storageRef);
                await addDoc(collection(db, 'gallery'), {
                    userId: currentUser.uid,
                    url: url,
                    type: file.type.startsWith('video') ? 'video' : 'image',
                    createdAt: serverTimestamp()
                });
            }
            loadGallery();
            logActivity('Uploaded to gallery');
        };

        function loadGallery() {
            const q = query(collection(db, 'gallery'), where('userId', '==', currentUser.uid), orderBy('createdAt', 'desc'));
            onSnapshot(q, (snap) => {
                const galleryDiv = document.getElementById('userGallery');
                galleryDiv.innerHTML = '';
                snap.docs.forEach(doc => {
                    const item = doc.data();
                    const media = document.createElement(item.type === 'video' ? 'video' : 'img');
                    media.src = item.url;
                    media.className = 'media-item';
                    media.controls = item.type === 'video';
                    galleryDiv.appendChild(media);
                });
            });
        }

        // Friends
        async function loadFriends() {
            const friendsQuery = query(collection(db, 'friends'), where('userId', '==', currentUser.uid));
            const snap = await getDocs(friendsQuery);
            friends = snap.docs.map(d => d.data().friendId);
            document.getElementById('chatFriend').innerHTML = '<option>Select friend</option>' + 
                friends.map(id => `<option value="${id}">Friend ${id.slice(0,8)}</option>`).join('');
        }

        window.searchFriends = async () => {
            const queryStr = document.getElementById('searchFriends').value.toLowerCase();
            if (queryStr.length < 2) return;
            
            const usersQuery = query(collection(db, 'users'), where('name', '>=', queryStr));
            const snap = await getDocs(usersQuery);
            const friendsDiv = document.getElementById('friendsList');
            friendsDiv.innerHTML = '';
            snap.docs.forEach(doc => {
                const user = doc.data();
                if (user.uid !== currentUser.uid && !friends.includes(user.uid)) {
                    const col = document.createElement('div');
                    col.className = 'col-md-4 mb-3';
                    col.innerHTML = `
                        <div class="card friend-card h-100">
                            <div class="card-body text-center">
                                <img src="${user.photoUrl || 'https://via.placeholder.com/80'}" class="rounded-circle mb-2" width="80" height="80">
                                <h6>${user.name}</h6>
                                <button class="btn btn-primary btn-sm" onclick="sendFriendRequest('${user.uid}')">Add Friend</button>
                            </div>
                        </div>
                    `;
                    friendsDiv.appendChild(col);
                }
            });
        };

        window.sendFriendRequest = async (targetId) => {
            await addDoc(collection(db, 'friendRequests'), {
                fromId: currentUser.uid,
                toId: targetId,
                status: 'pending',
                createdAt: serverTimestamp()
            });
            showNotification('Friend request sent!', 'info');
        };

        // To-Do
        window.addTodo = async () => {
            const task = document.getElementById('newTodo').value;
            if (task) {
                await addDoc(collection(db, 'todos'), {
                    userId: currentUser.uid,
                    task: task,
                    done: false,
                    createdAt: serverTimestamp()
                });
                document.getElementById('newTodo').value = '';
                loadTodos();
            }
        };

        function loadTodos() {
            const q = query(collection(db, 'todos'), where('userId', '==', currentUser.uid), orderBy('createdAt'));
            onSnapshot(q, (snap) => {
                const todoDiv = document.getElementById('todoList');
                todoDiv.innerHTML = '';
                snap.docs.forEach(doc => {
                    const todo = doc.data();
                    const item = document.createElement('div');
                    item.className = `todo-item ${todo.done ? 'text-decoration-line-through text-muted' : ''}`;
                    item.innerHTML = `
                        <input type="checkbox" class="todo-checkbox" ${todo.done ? 'checked' : ''} onchange="toggleTodo('${doc.id}', this.checked)">
                        <span>${todo.task}</span>
                        <button class="btn btn-sm btn-danger ms-auto" onclick="deleteTodo('${doc.id}')"><i class="fas fa-trash"></i></button>
                    `;
                    todoDiv.appendChild(item);
                });
            });
        }

        window.toggleTodo = async (id, done) => {
            await updateDoc(doc(db, 'todos', id), { done: done });
        };

        window.deleteTodo = async (id) => {
            await deleteDoc(doc(db, 'todos', id));
        };

        // Study Plans
        window.addStudySession = async () => {
            await addDoc(collection(db, 'studySessions'), {
                userId: currentUser.uid,
                subject: document.getElementById('studySubject').value,
                duration: parseInt(document.getElementById('studyDuration').value),
                notes: document.getElementById('studyNotes').value,
                createdAt: serverTimestamp()
            });
            // Clear form
            ['studySubject', 'studyDuration', 'studyNotes'].forEach(id => document.getElementById(id).value = '');
            loadStudySessions();
        };

        function loadStudySessions() {
            const q = query(collection(db, 'studySessions'), where('userId', '==', currentUser.uid), orderBy('createdAt', 'desc'));
            onSnapshot(q, (snap) => {
                const studyDiv = document.getElementById('studyList');
                studyDiv.innerHTML = '';
                snap.docs.forEach(doc => {
                    const session = doc.data();
                    const card = document.createElement('div');
                    card.className = 'card mb-2';
                    card.innerHTML = `
                        <div class="card-body">
                            <h6>${session.subject}</h6>
                            <p>${session.duration} min - ${session.notes}</p>
                            <small>${session.createdAt?.toDate().toLocaleString()}</small>
                        </div>
                    `;
                    studyDiv.appendChild(card);
                });
            });
        }

        // Chat
        window.loadChat = () => {
            const friendId = document.getElementById('chatFriend').value;
            if (!friendId) return;
            
            const q = query(collection(db, 'messages'), 
                where('toId', '==', currentUser.uid), 
                where('fromId', '==', friendId),
                orderBy('createdAt'));
            onSnapshot(q, (snap) => {
                const chatDiv = document.getElementById('chatMessages');
                chatDiv.innerHTML = '';
                snap.docs.forEach(doc => {
                    const msg = doc.data();
                    const bubble = document.createElement('div');
                    bubble.className = `mb-2 p-2 rounded ${msg.fromId === currentUser.uid ? 'bg-primary text-white ms-auto' : 'bg-light'}`;
                    bubble.style.maxWidth = '70%';
                    bubble.textContent = msg.text;
                    chatDiv.appendChild(bubble);
                });
                chatDiv.scrollTop = chatDiv.scrollHeight;
            });
        };

        window.sendMessage = () => {
            const friendId = document.getElementById('chatFriend').value;
            const text = document.getElementById('chatInput').value;
            if (friendId && text) {
                addDoc(collection(db, 'messages'), {
                    fromId: currentUser.uid,
                    toId: friendId,
                    text: text,
                    createdAt: serverTimestamp()
                });
                document.getElementById('chatInput').value = '';
            }
        };

        // Profile
        window.updateProfilePic = async () => {
            const file = document.getElementById('profilePhoto').files[0];
            if (file) {
                const storageRef = ref(storage, `profiles/${currentUser.uid}`);
                await uploadBytes(storageRef, file);
                const url = await getDownloadURL(storageRef);
                const userQuery = query(collection(db, 'users'), where('uid', '==', currentUser.uid));
                const snap = await getDocs(userQuery);
                await updateDoc(doc(db, 'users', snap.docs[0].id), { photoUrl: url });
                document.getElementById('profilePic').src = url;
            }
        };

        window.updateProfile = async () => {
            const userQuery = query(collection(db, 'users'), where('uid', '==', currentUser.uid));
            const snap = await getDocs(userQuery);
            await updateDoc(doc(db, 'users', snap.docs[0].id), {
                name: document.getElementById('profileName').textContent || 'User',
                bio: document.getElementById('profileBio').value
            });
            showNotification('Profile updated!', 'success');
        };

        // Activity Log
        function logActivity(action) {
            addDoc(collection(db, 'activities'), {
                userId: currentUser.uid,
                action: action,
                timestamp: serverTimestamp()
            });
        }

        function loadActivity() {
            const q = query(collection(db, 'activities'), where('userId', '==', currentUser.uid), orderBy('timestamp', 'desc'), limit(20));
            onSnapshot(q, (snap) => {
                const logDiv = document.getElementById('activityLog');
                logDiv.innerHTML = '';
                snap.docs.forEach(doc => {
                    const activity = doc.data();
                    const item = document.createElement('div');
                    item.className = 'list-group-item';
                    item.innerHTML = `<strong>${activity.action}</strong> - ${activity.timestamp?.toDate().toLocaleString()}`;
                    logDiv.appendChild(item);
                });
            });
        }

        // Tab switching
        window.showTab = (tabName) => {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            
            // Load tab data
            switch(tabName) {
                case 'feed': loadFeed(); break;
                case 'gallery': loadGallery(); break;
                case 'todo': loadTodos(); break;
                case 'study': loadStudySessions(); break;
                case 'activity': loadActivity(); break;
            }
        };

        function showNotification(message, type = 'info') {
            const notif = document.createElement('div');
            notif.className = `notification alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'}`;
            notif.textContent = message;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 3000);
        }

        // Init
        loadFeed();
        loadGallery();
        loadTodos();
        loadStudySessions();
        loadActivity();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
